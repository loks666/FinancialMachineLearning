# ğŸ“Œ **åŸºäº CAPM å’Œå‡å€¼-æ–¹å·®ä¼˜åŒ–ï¼ˆMVOï¼‰çš„æŠ•èµ„ç»„åˆä¼˜åŒ– [è‹±æ–‡](README_en.md)**
--- 

## ğŸ“– **1. é¡¹ç›®ç®€ä»‹**
æœ¬é¡¹ç›®é‡‡ç”¨ **èµ„æœ¬èµ„äº§å®šä»·æ¨¡å‹ï¼ˆCAPMï¼‰** å’Œ **å‡å€¼-æ–¹å·®ä¼˜åŒ–ï¼ˆMean-Variance Optimization, MVOï¼‰**ï¼Œé€šè¿‡ **äºŒæ¬¡è§„åˆ’ï¼ˆQuadratic Programming, QPï¼‰** è®¡ç®—æœ€ä¼˜æŠ•èµ„ç»„åˆã€‚  
é¡¹ç›®ç›®æ ‡ï¼š
- **è®¡ç®— CAPM å‚æ•°ï¼ˆÎ² å€¼ã€é¢„æœŸæ”¶ç›Šã€ä¸ªä½“é£é™©ï¼‰**
- **ä¼˜åŒ–æŠ•èµ„ç»„åˆæƒé‡ï¼Œæœ€å°åŒ–é£é™©**
- **ç»˜åˆ¶æœ‰æ•ˆå‰æ²¿ï¼ˆEfficient Frontierï¼‰**ï¼Œåˆ†æ **é£é™©-æ”¶ç›Šæƒè¡¡**

---

## ğŸ— **2. é¡¹ç›®ç»“æ„**
```
ğŸ“‚ FinancialMachineLearning
â”‚â”€â”€ ğŸ“‚ doc                     # é¡¹ç›®æ–‡æ¡£
â”‚   â”‚â”€â”€ ğŸ“œ CF969.pdf           # æŠ¥å‘Šæ–‡æ¡£ç¤ºä¾‹
â”‚   â”‚â”€â”€ ğŸ“œ CF969 - SP ZU - Assignment.pdf # è¦æ±‚æ–‡æ¡£
â”‚â”€â”€ ğŸ“‚ report                  # ç ”ç©¶æŠ¥å‘Š
â”‚   â”‚â”€â”€ ğŸ“œ report_cn.md        # ä¸­æ–‡æŠ¥å‘Š
â”‚   â”‚â”€â”€ ğŸ“œ report_en.md        # è‹±æ–‡æŠ¥å‘Š
â”‚â”€â”€ ğŸ“‚ result                  # è®¡ç®—ç»“æœ
â”‚   â”‚â”€â”€ ğŸ“œ adj_close_data.csv  # è‚¡ç¥¨æ”¶ç›˜ä»·æ•°æ®
â”‚   â”‚â”€â”€ ğŸ“œ capm_results.csv    # CAPM è®¡ç®—ç»“æœ
â”‚   â”‚â”€â”€ ğŸ“œ efficient_frontier.png # æœ‰æ•ˆå‰æ²¿å›¾
â”‚   â”‚â”€â”€ ğŸ“œ optimal_portfolio_weights.csv # æœ€ä¼˜æŠ•èµ„ç»„åˆæƒé‡
â”‚   â”‚â”€â”€ ğŸ“œ returns_data.csv    # æ¯æ—¥æ”¶ç›Šç‡æ•°æ®
â”‚â”€â”€ ğŸ“œ .gitignore              # Git å¿½ç•¥æ–‡ä»¶
â”‚â”€â”€ ğŸ“œ all_code.png            # ä»£ç æˆªå›¾
â”‚â”€â”€ ğŸ“œ financial.ipynb         # **Jupyter Notebook æ–‡ä»¶ï¼ŒåŒ…å«æ‰€æœ‰ä»£ç **
â”‚â”€â”€ ğŸ“œ README.md               # è‡ªè¿°æ–‡ä»¶ï¼ˆä¸­æ–‡ï¼‰
â”‚â”€â”€ ğŸ“œ README_en.md            # è‡ªè¿°æ–‡ä»¶ï¼ˆè‹±æ–‡ï¼‰
```

---

## âš™ï¸ **3. ç¯å¢ƒé…ç½®**
### ğŸ”¹ **3.1 åˆ›å»º Conda è™šæ‹Ÿç¯å¢ƒ**
æœ¬é¡¹ç›®åŸºäº **Python 3.12.7** è¿è¡Œï¼Œå»ºè®®ä½¿ç”¨ Conda åˆ›å»ºç¯å¢ƒï¼š
```bash
conda create -n financial python=3.12.7
conda activate financial
```
### ğŸ”¹ **3.2 å®‰è£…ä¾èµ–**
```bash
pip install -r requirements.txt
```
æˆ–æ‰‹åŠ¨å®‰è£…ï¼š
```bash
pip install numpy pandas matplotlib statsmodels cvxopt yfinance
```

---

## ğŸš€ **4. è¿è¡Œé¡¹ç›®**
æœ¬é¡¹ç›®æ‰€æœ‰ä»£ç éƒ½å­˜æ”¾åœ¨ `financial.ipynb` Jupyter Notebook æ–‡ä»¶ä¸­ï¼ŒåŒ…å« **æ•°æ®ä¸‹è½½ã€CAPM è®¡ç®—ã€æŠ•èµ„ç»„åˆä¼˜åŒ–ã€å¯è§†åŒ–** ç­‰å®Œæ•´æµç¨‹ã€‚  
è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿è¡Œï¼š

### ğŸ”¹ **4.1 å¯åŠ¨ Jupyter Notebook**
```bash
jupyter lab
```
æˆ–ï¼š
```bash
jupyter notebook
```
ç„¶åæ‰“å¼€ `financial.ipynb`ï¼Œé€æ­¥è¿è¡Œä»£ç ã€‚

### ä»£ç è¿è¡Œæˆªå›¾
![all_code.png](all_code.png)

---

### ğŸ”¹ **4.2 ä»£ç åŒ…å«çš„ä¸»è¦æµç¨‹**
1ï¸âƒ£ **æ•°æ®ä¸‹è½½**
   - ä» Yahoo Finance è·å– **è‚¡ç¥¨å†å²æ”¶ç›˜ä»·**
   - è®¡ç®— **æ¯æ—¥æ”¶ç›Šç‡**
   - ç”Ÿæˆ `adj_close_data.csv` å’Œ `returns_data.csv`

2ï¸âƒ£ **CAPM è®¡ç®—**
   - è®¡ç®— **Î² å€¼ï¼ˆBetaï¼‰ã€é¢„æœŸæ”¶ç›Šã€ä¸ªä½“é£é™©**
   - å­˜å‚¨è®¡ç®—ç»“æœåˆ° `capm_results.csv`

3ï¸âƒ£ **æœ€ä¼˜æŠ•èµ„ç»„åˆè®¡ç®—**
   - ä½¿ç”¨ **äºŒæ¬¡è§„åˆ’ï¼ˆQPï¼‰** è®¡ç®—æœ€ä¼˜æƒé‡
   - ç›®æ ‡æ”¶ç›Šç‡åˆ†åˆ«ä¸º **0.08, 0.12, 0.15**
   - ç”Ÿæˆ `optimal_portfolio_weights.csv`

4ï¸âƒ£ **ç»˜åˆ¶æœ‰æ•ˆå‰æ²¿**
   - è®¡ç®— **æŠ•èµ„ç»„åˆé£é™©**
   - ç”Ÿæˆ **æœ‰æ•ˆå‰æ²¿å›¾ `efficient_frontier.png`**

---

## â— **5. é‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ**
åœ¨æ•´ä¸ªè®¡ç®—è¿‡ç¨‹ä¸­ï¼Œæˆ‘é‡åˆ°äº†å‡ ä¸ªå…³é”®é—®é¢˜ï¼Œä»¥ä¸‹æ˜¯é—®é¢˜æè¿°åŠè§£å†³æ€è·¯ï¼š

### ğŸ”¹ **5.1 `cvxopt.solvers.qp()` é‡åˆ°å¥‡å¼‚ KKT çŸ©é˜µ**
#### **é—®é¢˜**
åœ¨æ‰§è¡Œ `cvxopt.solvers.qp()` æ—¶ï¼Œé‡åˆ°äº† `singular KKT matrix` é”™è¯¯ã€‚  
**åŸå› ï¼š**
- åæ–¹å·®çŸ©é˜µ `Î£` å¯èƒ½ä¸å¯é€†ï¼Œå¯¼è‡´æœ€ä¼˜åŒ–é—®é¢˜æ— è§£ã€‚
- è‚¡ç¥¨æ”¶ç›Šç‡æ•°æ®å­˜åœ¨ **å¤šé‡å…±çº¿æ€§**ï¼Œå³ä¸åŒè‚¡ç¥¨çš„æ”¶ç›Šç‡é«˜åº¦ç›¸å…³ï¼Œå¯¼è‡´çŸ©é˜µè¡Œåˆ—å¼è¶‹è¿‘äºé›¶ã€‚

#### **è§£å†³æ–¹æ¡ˆ**
- é‡‡ç”¨ **NumPy** çš„ `np.outer` è®¡ç®—åæ–¹å·®çŸ©é˜µï¼Œè€Œä¸æ˜¯ä½¿ç”¨ `for` å¾ªç¯ï¼Œæé«˜æ•°å€¼ç¨³å®šæ€§ï¼š
  ```python
  beta_matrix = np.array([beta_values[stock] for stock in stock_list])
  idiosyncratic_var_vector = np.array([idiosyncratic_variance[stock] for stock in stock_list])
  covariance_matrix = np.outer(beta_matrix, beta_matrix) * market_variance
  np.fill_diagonal(covariance_matrix, np.diag(covariance_matrix) + idiosyncratic_var_vector)
  ```
- è‹¥åæ–¹å·®çŸ©é˜µä»ä¸å¯é€†ï¼Œ**å¢åŠ ä¸€ä¸ªå°çš„æ­£åˆ™åŒ–å‚æ•°**ï¼š
  ```python
  covariance_matrix += np.eye(len(stock_list)) * 1e-6  # åŠ å…¥å°çš„æ­£åˆ™é¡¹ï¼Œå¢å¼ºå¯é€†æ€§
  ```

---

### ğŸ”¹ **5.2 `A` çº¦æŸçŸ©é˜µç»´åº¦ä¸åŒ¹é…**
#### **é—®é¢˜**
åœ¨ `cvxopt.solvers.qp()` è®¡ç®—æœ€ä¼˜æŠ•èµ„ç»„åˆæ—¶ï¼Œå‡ºç° `TypeError: 'A' must be a 'd' matrix with n columns`ã€‚

#### **åŸå› **
- `A` çŸ©é˜µçš„å½¢çŠ¶ **é”™è¯¯**ï¼Œæœ¬åº”æ˜¯ **(2 Ã— num_assets)**ï¼Œä½†å®é™…å¯èƒ½æ˜¯ **(num_assets Ã— 2)**ã€‚

#### **è§£å†³æ–¹æ¡ˆ**
- åœ¨æ„é€  `A` çŸ©é˜µæ—¶ï¼Œ**ç¡®ä¿å…¶å½¢çŠ¶ä¸º (2 Ã— num_assets)**ï¼š
  ```python
  A = matrix(np.vstack((np.ones(num_assets), [expected_returns[stock] for stock in stock_list])), tc='d').T
  ```
- ç¡®ä¿ `b` ä¹Ÿæ˜¯ `cvxopt` **double ç±»å‹**ï¼š
  ```python
  b = matrix([1.0, mu_p], tc='d')
  ```

---

### ğŸ”¹ **5.3 è´Ÿæƒé‡é—®é¢˜**
#### **é—®é¢˜**
æŸäº›æœ€ä¼˜æŠ•èµ„ç»„åˆçš„æƒé‡ä¸º **è´Ÿå€¼**ï¼Œå³å‡ºç° **åšç©ºä»“ä½**ï¼Œä½†æ­¤ä¼˜åŒ–ç›®æ ‡è¦æ±‚ **ä¸å…è®¸åšç©º**ã€‚

#### **è§£å†³æ–¹æ¡ˆ**
- é‡‡ç”¨ **ç»å¯¹å€¼** ä¿®æ­£è´Ÿæƒé‡ï¼š
  ```python
  weights = np.abs(weights)
  ```
- é‡æ–° **å½’ä¸€åŒ–** æƒé‡ï¼Œä½¿æ€»å’Œä¸º 1ï¼š
  ```python
  weights /= np.sum(weights)
  ```

---

### ğŸ”¹ **5.4 è®¡ç®— `portfolio_variance` å‡ºç°ç»´åº¦é”™è¯¯**
#### **é—®é¢˜**
åœ¨è®¡ç®—æŠ•èµ„ç»„åˆé£é™©æ—¶ï¼Œ`weights.T @ covariance_matrix @ weights` å¯èƒ½æŠ¥é”™ã€‚

#### **è§£å†³æ–¹æ¡ˆ**
- é‡‡ç”¨ `np.dot()` ç¡®ä¿çŸ©é˜µè¿ç®—æ­£ç¡®ï¼š
  ```python
  portfolio_variance = np.dot(weights.T, np.dot(covariance_matrix, weights))
  ```

---

### ğŸ”¹ **5.5 `market_variance` è®¡ç®—é—®é¢˜**
#### **é—®é¢˜**
åœ¨è®¡ç®— `market_variance = np.var(market_returns)` æ—¶ï¼Œå¯èƒ½å‡ºç° **ç±»å‹è½¬æ¢é”™è¯¯**ï¼Œå¯¼è‡´è®¡ç®—å¼‚å¸¸ã€‚

#### **è§£å†³æ–¹æ¡ˆ**
- å¼ºåˆ¶è½¬æ¢ `market_returns` ä¸º `float64`ï¼š
  ```python
  market_variance = np.var(market_returns.astype(np.float64))
  ```

---

## ğŸ¯ **6. æœªæ¥ä¼˜åŒ–æ–¹å‘**
âœ… **æ‰©å±•èµ„äº§ç±»åˆ«**ï¼ˆå¦‚å€ºåˆ¸ã€ETFï¼‰ä¼˜åŒ–æŠ•èµ„ç»„åˆ  
âœ… **è€ƒè™‘å¸‚åœºæ³¢åŠ¨æ€§å˜åŒ–**ï¼Œä½¿ç”¨ **GARCH æ¨¡å‹æˆ– Fama-French å› å­æ¨¡å‹**  
âœ… **ä¼˜åŒ–æŠ•èµ„ç»„åˆæƒé‡**ï¼Œç»“åˆ **åŠ¨æ€èµ„äº§é…ç½®ï¼ˆDFAï¼‰** ç­–ç•¥  

---

## ğŸ“¬ **7. è”ç³»æ–¹å¼ & è´¡çŒ®**
ğŸ”¹ **Email:** [generalfly666@outlook.com](mailto:generalfly666@outlook.com)  
ğŸ”¹ **GitHub:** [GitHub Repository](https://github.com/loks666)  
ğŸ”¹ **è´¡çŒ®æ–¹å¼:** Fork æœ¬ä»“åº“å¹¶æäº¤ Pull Requestã€‚  

---

ğŸš€ **æœ¬é¡¹ç›®ä¼˜åŒ–äº† CAPM è®¡ç®—å’ŒæŠ•èµ„ç»„åˆä¼˜åŒ–æ–¹æ³•ï¼Œæ¬¢è¿äº¤æµä¸æ”¹è¿›ï¼** ğŸ˜Š